KDE_CXXFLAGS = $(USE_EXCEPTIONS)

bin_PROGRAMS = rosegarden

rosegarden_SOURCES = \
        audiocommands.cpp \
        audiomanagerdialog.cpp \
        audioplugindialog.cpp \
        audiopluginmanager.cpp \
	audiopluginoscgui.cpp \
	audiosynthmanager.cpp \
        bankeditor.cpp\
        barbuttons.cpp \
	basiccommand.cpp \
	chordnameruler.cpp \
	colours.cpp \
	colourwidgets.cpp \
        commondialogs.cpp \
        constants.cpp \
        controleditor.cpp \
        controlruler.cpp \
	csoundio.cpp \
	deviceeditor.cpp \
	devicemanager.cpp \
	dialogs.cpp \
	editcommands.cpp \
	edittool.cpp \
	editview.cpp \
	editviewbase.cpp \
        eventcommands.cpp \
	eventfilter.cpp \
        eventview.cpp \
        hydrogenio.cpp \
	importdevicedialog.cpp \
        instrumentparameterbox.cpp \
	kde32_ktabwidget.cpp \
	kde32_ktabbar.cpp \
	kstartuplogo.cpp \
	ktmpstatusmsg.cpp \
        lilypondio.cpp \
        linedstaff.cpp \
        loopruler.cpp \
	main.cpp \
        markereditor.cpp \
	matrixcanvasview.cpp \
	matrixcommands.cpp \
	matrixelement.cpp \
	matrixhlayout.cpp \
        matrixparameterbox.cpp \
	matrixstaff.cpp \
	matrixtool.cpp \
	matrixview.cpp \
	matrixvlayout.cpp \
        midifilter.cpp \
        midipitchlabel.cpp \
	mixer.cpp \
	mmapper.cpp \
	multiviewcommandhistory.cpp \
	mupio.cpp \
        musicxmlio.cpp \
	notationcanvasview.cpp \
	notationcommands.cpp \
	notationelement.cpp \
	notationhlayout.cpp \
	notationproperties.cpp \
	notationsets.cpp \
	notationstaff.cpp \
	notationstrings.cpp \
	notationtool.cpp \
	notationview.cpp \
	notationviewslots.cpp \
	notationvlayout.cpp \
	notecharname.cpp \
	notefont.cpp \
	notefontviewer.cpp \
	notepixmapfactory.cpp \
	notestyle.cpp \
	pianokeyboard.cpp \
	pixmapfunctions.cpp \
	playlist.cpp \
	qcanvasgroupableitem.cpp \
	qcanvassimplesprite.cpp \
	qdeferscrollview.cpp \
	rawnoteruler.cpp \
	rg21io.cpp \
	rgapplication.cpp \
	rgled.cpp \
	rosedebug.cpp \
	rosegardencanvasview.cpp \
        rosegardenconfiguredialog.cpp \
	rosegardengui.cpp \
	rosegardenguidoc.cpp \
	rosegardenguiiface.cpp \
	rosegardenguiiface.skel \
	rosegardenguiview.cpp \
        rosegardentransport.ui \
        rosegardentransportdialog.cpp \
	rosestrings.cpp \
	rosexmlhandler.cpp \
	scrollbox.cpp \
	segmentcanvas.cpp \
        segmentcommands.cpp \
        segmentparameterbox.cpp \
        segmenttool.cpp \
        sequencemanager.cpp \
        sequencermapper.cpp \
	spline.cpp \
	staffline.cpp \
        studiocommands.cpp \
        studiocontrol.cpp \
        studiowidgets.cpp \
	tempocolour.cpp \
	temporuler.cpp \
	tempoview.cpp \
	textruler.cpp \
	timewidget.cpp \
        trackbuttons.cpp \
	trackeditor.cpp \
        trackheader.cpp \
        tracklabel.cpp \
	trackseditoriface.skel \
	triggermanager.cpp \
        velocitycolour.cpp \
        vumeter.cpp \
        widgets.cpp \
	xmlstorableevent.cpp

rosegarden_LDADD   = ../sound/libRosegardenSound.la ../base/libbase.la -lkdeui -lkdecore -lkdeprint $(LIB_QT) $(LIBSOCKET) $(LIB_KFILE) @XFT_LIBS@ @JACK_LIBS@ @LIBLO_LIBS@

SUBDIRS = docs

EXTRA_DIST = \
	fonts/*.pfa \
	fonts/mappings/*.xml \
	pixmaps/icons/*.xpm \
	pixmaps/icons/*.png \
	pixmaps/rg21/4/*.xpm \
	pixmaps/rg21/8/*.xpm \
	pixmaps/feta/4/*.xpm \
	pixmaps/feta/6/*.xpm \
	pixmaps/feta/8/*.xpm \
	pixmaps/feta/10/*.xpm \
	pixmaps/feta/12/*.xpm \
	pixmaps/toolbar/*.xpm \
	pixmaps/transport/*.xpm \
	pixmaps/*.png \
        pixmaps/misc/*.xpm \
	styles/*.xml \
	testfiles/*.rg \
        testfiles/audio/*.wav \
	testfiles/*.rose \
	library/*.rgd

# Where pixmaps for notes, clefs, etc... will be installed
data_dirname = rosegarden

install-data-local:
	$(mkinstalldirs) $(kde_appsdir)/Applications/
	$(INSTALL_DATA) $(srcdir)/rosegarden.desktop $(kde_appsdir)/Applications
	$(mkinstalldirs) $(kde_mimedir)/audio/
	$(INSTALL_DATA) $(srcdir)/x-*.desktop $(kde_mimedir)/audio
	$(mkinstalldirs) $(kde_icondir)/hicolor/48x48/apps/
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/rg-rwb-rose3-48x48.png $(DESTDIR)$(kde_icondir)/hicolor/48x48/apps/rosegarden.png
	$(mkinstalldirs) $(kde_icondir)/hicolor/64x64/apps/
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/rg-rwb-rose3-64x64.png $(DESTDIR)$(kde_icondir)/hicolor/48x48/apps/rosegarden.png
	$(mkinstalldirs) $(kde_icondir)/hicolor/128x128/apps/
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/rg-rwb-rose3-128x128.png $(DESTDIR)$(kde_icondir)/hicolor/48x48/apps/rosegarden.png
	$(mkinstalldirs) $(kde_icondir)/locolor/32x32/apps/
	$(mkinstalldirs) $(kde_icondir)/hicolor/32x32/apps/
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/cc-hi32-rosegarden.xpm $(DESTDIR)$(kde_icondir)/locolor/32x32/apps/rosegarden.xpm
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/rg-rwb-rose3-32x32.png $(DESTDIR)$(kde_icondir)/hicolor/32x32/apps/rosegarden.png
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/mm-mime-hi32-rosegarden.png $(DESTDIR)$(kde_icondir)/hicolor/32x32/mimetypes/x-rosegarden.png
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/mm-mime-hi32-rosegarden.png $(DESTDIR)$(kde_icondir)/locolor/32x32/mimetypes/x-rosegarden.png
	$(mkinstalldirs) $(kde_icondir)/locolor/16x16/apps/
	$(mkinstalldirs) $(kde_icondir)/hicolor/16x16/apps/
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/cc-hi16-rosegarden.xpm $(DESTDIR)$(kde_icondir)/locolor/16x16/apps/rosegarden.xpm
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/rg-rwb-rose3-16x16.png $(DESTDIR)$(kde_icondir)/hicolor/16x16/apps/rosegarden.png
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/mm-mime-hi16-rosegarden.png $(DESTDIR)$(kde_icondir)/hicolor/16x16/mimetypes/x-rosegarden.png
	- $(INSTALL_DATA) $(srcdir)/pixmaps/icons/mm-mime-hi16-rosegarden.png $(DESTDIR)$(kde_icondir)/locolor/16x16/mimetypes/x-rosegarden.png
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/examples
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/styles
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/pixmaps
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/pixmaps/misc
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/pixmaps/toolbar
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/pixmaps/transport
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/rg21
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/rg21/4
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/rg21/8
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/feta
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/feta/4
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/feta/6
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/feta/8
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/feta/10
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/feta/12
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/fonts/mappings
	$(mkinstalldirs) $(kde_datadir)/$(data_dirname)/library
	$(INSTALL_DATA) $(srcdir)/testfiles/glazunov.rg $(kde_datadir)/$(data_dirname)/examples
	$(INSTALL_DATA) $(srcdir)/testfiles/notation-for-string-orchestra-in-D-minor.rg $(kde_datadir)/$(data_dirname)/examples
	$(INSTALL_DATA) $(srcdir)/styles/*.xml $(kde_datadir)/$(data_dirname)/styles
	$(INSTALL_DATA) $(srcdir)/testfiles/ravel-pc-gmaj-adagio.rg $(kde_datadir)/$(data_dirname)/examples
	$(INSTALL_DATA) $(srcdir)/testfiles/perfect-moment.rg $(kde_datadir)/$(data_dirname)/examples
	$(INSTALL_DATA) $(srcdir)/fonts/*.pfa $(kde_datadir)/$(data_dirname)/fonts
	$(INSTALL_DATA) $(srcdir)/fonts/mappings/*.xml $(kde_datadir)/$(data_dirname)/fonts/mappings
	$(INSTALL_DATA) $(srcdir)/pixmaps/misc/*.xpm $(kde_datadir)/$(data_dirname)/pixmaps/misc
	$(INSTALL_DATA) $(srcdir)/pixmaps/rg21/4/*.xpm     $(kde_datadir)/$(data_dirname)/fonts/rg21/4
	$(INSTALL_DATA) $(srcdir)/pixmaps/rg21/8/*.xpm     $(kde_datadir)/$(data_dirname)/fonts/rg21/8
	$(INSTALL_DATA) $(srcdir)/pixmaps/feta/4/*.xpm     $(kde_datadir)/$(data_dirname)/fonts/feta/4
	$(INSTALL_DATA) $(srcdir)/pixmaps/feta/6/*.xpm     $(kde_datadir)/$(data_dirname)/fonts/feta/6
	$(INSTALL_DATA) $(srcdir)/pixmaps/feta/8/*.xpm     $(kde_datadir)/$(data_dirname)/fonts/feta/8
	$(INSTALL_DATA) $(srcdir)/pixmaps/feta/10/*.xpm    $(kde_datadir)/$(data_dirname)/fonts/feta/10
	$(INSTALL_DATA) $(srcdir)/pixmaps/feta/12/*.xpm    $(kde_datadir)/$(data_dirname)/fonts/feta/12
	$(INSTALL_DATA) $(srcdir)/pixmaps/toolbar/*.xpm    $(kde_datadir)/$(data_dirname)/pixmaps/toolbar
	$(INSTALL_DATA) $(srcdir)/pixmaps/transport/*.xpm  $(kde_datadir)/$(data_dirname)/pixmaps/transport
	$(INSTALL_DATA) $(srcdir)/pixmaps/splash.png       $(kde_datadir)/$(data_dirname)/pixmaps
	$(INSTALL_DATA) $(srcdir)/testfiles/autoload.rg    $(kde_datadir)/$(data_dirname)
	$(INSTALL_DATA) $(srcdir)/library/*.rgd            $(kde_datadir)/$(data_dirname)/library
	$(INSTALL_DATA) $(srcdir)/docs/en/tips             $(kde_datadir)/$(data_dirname)
	perl -ne 'print "$$1\n" if /#define VERSION "(.*?)"/;' $(top_builddir)/config.h > $(DESTDIR)$(kde_datadir)/$(data_dirname)/version.txt


# Previous way to extract version from config.h, keeping around just in case :
# grep VERSION $(top_builddir)/config.h | sed 's/^[^"]*"//' | sed 's/"[^"]*//' |head -1 > $(kde_datadir)/$(data_dirname)/version.txt



uninstall-local:
	-rm -f $(kde_datadir)/$(data_dirname)/version.txt
	-rm -f $(kde_appsdir)/Applications/rosegarden.desktop
	-rm -f $(kde_icondir)/hicolor/48x48/apps/rosegarden.xpm
	-rm -f $(kde_icondir)/locolor/32x32/apps/rosegarden.xpm
	-rm -f $(kde_icondir)/hicolor/32x32/apps/rosegarden.xpm
	-rm -f $(kde_icondir)/locolor/16x16/apps/rosegarden.xpm
	-rm -f $(kde_icondir)/hicolor/16x16/apps/rosegarden.xpm
	-rm -rf $(kde_datadir)/$(data_dirname)/styles
	-rm -rf $(kde_datadir)/$(data_dirname)/pixmaps
	-rm -rf $(kde_datadir)/$(data_dirname)/fonts
	-rm -f $(kde_datadir)/$(data_dirname)/autoload.rg
	-rm -rf $(kde_datadir)/$(data_dirname)/library
	-rm -rf $(kde_datadir)/$(data_dirname)/tips

# this 10 paths are KDE specific. Use them:
# kde_htmldir       Where your docs should go to. (contains lang subdirs)
# kde_appsdir       Where your application file (.kdelnk) should go to. 
# kde_icondir       Where your icon should go to.
# kde_minidir       Where your mini icon should go to.
# kde_datadir       Where you install application data. (Use a subdir)
# kde_locale        Where translation files should go to.(contains lang subdirs)
# kde_cgidir        Where cgi-bin executables should go to.
# kde_confdir       Where config files should go to.
# kde_mimedir       Where mimetypes should go to.
# kde_toolbardir    Where general toolbar icons should go to.
# kde_wallpaperdir  Where general wallpapers should go to.

# set the include path for X, qt and KDE
INCLUDES= $(all_includes) -I$(top_srcdir)/base -I$(top_srcdir)/sound $(KDE_CXXFLAGS) @XFT_CFLAGS@ @JACK_CFLAGS@ @LIBLO_CFLAGS@

# claim, which subdirectories you want to install
# you can add here more. This one gets installed 

rosegarden_METASOURCES = AUTO

# the library search path. 
rosegarden_LDFLAGS = $(all_libraries) $(KDE_RPATH)

# them while "make clean", use CLEANFILES
DISTCLEANFILES = $(rosegarden_METASOURCES)

rcdir = $(kde_datadir)/rosegarden
rc_DATA = audiomanager.rc \
        bankeditor.rc \
	clefinserter.rc \
        controleditor.rc \
        devicemanager.rc \
	eventlist.rc \
        markereditor.rc \
	matrix.rc \
        matrixeraser.rc \
        matrixresizer.rc \
        matrixmover.rc \
        matrixpainter.rc \
        matrixselector.rc \
        midimixer.rc \
	mixer.rc \
	notation.rc \
	notationeraser.rc \
	notationselector.rc \
	noteinserter.rc \
	restinserter.rc \
	rosegardenui.rc \
	tempoview.rc \
	textinserter.rc \
	triggermanager.rc

# make messages.po. Move this one to ../po/ and "make merge" in po
# the -x is for skipping messages already translated in kdelibs
messages: rc.cpp
	rm -f tips.cpp fonts.cpp styles.cpp
	(cd docs/en && $(PREPARETIPS) > ../../tips.cpp)
	(cd fonts/mappings && cat *.xml | perl -e \
	  'while (<STDIN>) { if(/(encoding name|origin|copyright|mapped-by|type)\s*=\s*\"(.*)\"/) { print "i18n(\"$$2\")\;\n";} }' \
	  > ../../fonts.cpp)
	(cd styles && ls *.xml | perl -e 'while (<STDIN>) { if(/(.*)\.xml/) { print "i18n(\"$$1\")\;\n";} }' > ../styles.cpp)
	$(XGETTEXT) -C -ki18n -x $(KDEDIR)/include/kde.pot `find . -name \*.h -o -name \*.cpp -o -name \*.cc` -o ../po/rosegarden.pot 

