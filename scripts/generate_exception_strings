#!/bin/bash
#
# Copyright (c) 2009  D. Michael McIntyre <rosegarden.trumpeter@gmail.com>
# Released under the GPL
#
# REQUIRES: ack-grep (Debian's name for ack)
#
# PURPOSE: This pulls out the exception strings from constructs like
# 'Exception("Bad sound file")' and makes it possible to translate them.
#
# To avoid adding a new build dependency on ack (ack-grep) just to do this one
# job, which doesn't need to be updated very often (none of these strings have
# changed in years) we're just adding data/ExceptionStrings.cpp under version
# control, and someone should re-run this script and generate a new one whenever
# one of those strings changes and an update is required.  (Not expected to
# happen very often at all.)
#

of="data/ExceptionStrings.cpp"

cat > $of << EOF
/* THIS FILE WAS GENERATED BY $0
 *
 * DO NOT EDIT THIS FILE.
 * 
 * This file contains extracted exception strings and places them into the
 * QObject::tr() context for translation.  This is less complicated than
 * accomplishing the job by throwing around a bunch of Q_DECLARE_TR_FUNCTIONS or
 * whatever macros in the right bits of code, and wrapping all those calls in
 * QObject::tr() functions.  Instead, we'll wrap anything that ever presents an
 * exception to the user, which will require less coding to get the job done.
 *
 * This file is under version control because it is not expected to change
 * regularly enough to justify building automatic updates into the build system,
 * and because the script that generated it depends on an uncommon utility
 * whose inclusion would mean adding a new build dependency over something quite
 * trivial.
 */
EOF

for f in  `ack-grep "Exception\(\""|grep Exception|cut -d \" -f 2 | cut -d \" -f 1|uniq|sed "s/\ /_/g"`; do
    g=$(echo $f|sed "s/_/\ /g")
    cat >> $of << EOF

/* TRANSLATOR: this is an internal error string that will typically be included
 * as part of some error dialog reporting the nature of the failure to the
 * user. */
QObject::tr("$g");

EOF
done

exit 0
